<domain type='kvm'>
    <name>{{ vm_name }}</name>
    <memory unit='MiB'>{{ vm_ram_mb }}</memory>
    <vcpu placement='static'>{{ vm_vcpus }}</vcpu>
    <os>
        <type arch='x86_64' machine='pc-i440fx-8.1'>hvm</type>
        <loader readonly='yes' secure='no' type='pflash'>/usr/share/OVMF/OVMF_CODE.fd</loader>
        <boot dev='hd' />
    </os>
    <!-- ACPI é necessário para conseguir fazer um boot EFI -->
    <features>
        <acpi />
        <apic />
        <vmport state='off' />
    </features>
    <cpu mode='custom' match='exact' check='full'>
        <model fallback='forbid'>qemu64</model>
        <feature policy='require' name='x2apic' />
        <feature policy='require' name='hypervisor' />
        <feature policy='require' name='lahf_lm' />
        <feature policy='disable' name='svm' />
    </cpu>
    <devices>
        <emulator>/usr/bin/qemu-system-x86_64</emulator>
        <disk type='file' device='disk'>
            <driver name='qemu' type='qcow2' />
            <source file='{{ libvirt_pool_dir }}/{{libvirt_pool_name}}/{{ vm_name }}.qcow2' />
            <target dev='vda' bus='virtio' />
            <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0' />
        </disk>
        <disk type='file' device='disk'>
            <source file='{{ libvirt_pool_dir }}/{{ libvirt_pool_name }}/{{ vm_name }}_cidata.iso' />
            <target dev='vdb' bus='virtio' />
            <readonly/>
        </disk>
        <console type="pty">
            <target type="serial" port="1" />
        </console>
        <controller type='usb' index='0' model='piix3-uhci'>
            <alias name='usb' />
            <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2' />
        </controller>
        <controller type='pci' index='0' model='pci-root'>
            <alias name='pci.0' />
        </controller>
        <controller type='ide' index='0'>
            <alias name='ide' />
            <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x1' />
        </controller>
        {% if private_network_only is not defined %}
        <interface type='network'>
            <source network='default'/>
        </interface>
        {% endif %}
        {% if private_network_name is defined %}
        <interface type='network'>
            <source network='{{ private_network_name }}'/>
        </interface>
        {% endif %}
        <serial type='pty'>
            <source path='/dev/pts/5' />
            <target type='isa-serial' port='0'>
                <model name='isa-serial' />
            </target>
            <alias name='serial0' />
        </serial>
        <input type='mouse' bus='ps2'>
        </input>
        <input type='keyboard' bus='ps2'>
        </input>
        <graphics type='vnc' port='5900' autoport='yes' listen='0.0.0.0'>
            <listen type='address' address='0.0.0.0' />
        </graphics>
        <sound model='ich9'>
            <alias name='sound0' />
            <address type='pci' domain='0x0000' bus='0x00' slot='0x1b' function='0x0' />
        </sound>
        <audio id='1' type='none' />
        <video>
            <model type='cirrus' vram='16384' heads='1' primary='yes' />
            <alias name='video0' />
            <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0' />
        </video>
        <memballoon model='virtio'>
            <alias name='balloon0' />
            <address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0' />
        </memballoon>
    </devices>
    <seclabel type='dynamic' model='dac' relabel='yes'>
        <label>+64055:+108</label>
        <imagelabel>+64055:+108</imagelabel>
    </seclabel>
</domain>
