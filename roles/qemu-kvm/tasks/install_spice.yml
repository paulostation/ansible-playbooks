


# - name: Checking if ninja is already installed
#   stat:
#     path: /usr/bin/ninja
#   register: ninja_bin

# - debug:
#     msg: "ninja bin {{ ninja_bin.stat.exists }}"

# 9996  sudo apt install libspice-server1
#10010  sudo apt install libspice-protocol-dev libspice-server-dev\n
#10154  sudo apt install gir1.2-spiceclientgtk-3.0

- name: Install required packages
  ansible.builtin.apt:
    name:
      - libgstreamer1.0-dev
      - libgstreamer-plugins-base1.0-dev
      - liblz4-dev
      - libpixman-1-dev
      - libssl-dev
      - libjpeg-dev
      - libsasl2-dev
      - libspice-server1
      - libspice-protocol-dev
      - libspice-server-dev
      - gir1.2-spiceclientgtk-3.0
    state: present
  become: true

- name: Install spice
  block:
    - name: Cloning spice git repo
      git:
        repo: 'https://gitlab.freedesktop.org/spice/spice.git'
        dest: /tmp/spice
        force: yes

    - name: configure
      command: meson setup build
      args:
        chdir: /tmp/spice/

    - name: Build using ninja
      command: ninja -C build
      args:
        chdir: /tmp/spice/

    - name: Install using ninja
      command: ninja -C build install
      args:
        chdir: /tmp/spice/
      become: true

